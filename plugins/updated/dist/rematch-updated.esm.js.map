{"version":3,"file":"rematch-updated.esm.js","sources":["../lib/index.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = (function (config) {\n    if (config === void 0) { config = {}; }\n    var updatedModelName = config.name || 'updated';\n    var updated = {\n        name: updatedModelName,\n        reducers: {\n            onUpdate: function (state, payload) {\n                return (__assign({}, state, (_a = {}, _a[payload.name] = __assign({}, state[payload.name], (_b = {}, _b[payload.action] = new Date(), _b)), _a)));\n                var _a, _b;\n            },\n        },\n        state: {},\n    };\n    return {\n        config: {\n            models: {\n                updated: updated,\n            },\n        },\n        init: function (_a) {\n            var dispatch = _a.dispatch;\n            return ({\n                onModel: function (_a) {\n                    var _this = this;\n                    var name = _a.name;\n                    // do not run dispatch on loading, updated models\n                    var avoidModels = [updatedModelName, 'loading'];\n                    if (avoidModels.includes(name)) {\n                        return;\n                    }\n                    var modelActions = dispatch[name];\n                    // add empty object for effects\n                    updated.state[name] = {};\n                    // map over effects within models\n                    Object.keys(modelActions).forEach(function (action) {\n                        if (dispatch[name][action].isEffect) {\n                            // copy function\n                            var fn_1 = dispatch[name][action];\n                            // create function with pre & post loading calls\n                            var dispatchWithUpdateHook = function (props) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, fn_1(props)\n                                            // waits for dispatch function to finish before calling \"hide\"\n                                        ];\n                                        case 1:\n                                            _a.sent();\n                                            // waits for dispatch function to finish before calling \"hide\"\n                                            dispatch[updatedModelName].onUpdate({ name: name, action: action });\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); };\n                            // replace existing effect with new dispatch\n                            dispatch[name][action] = dispatchWithUpdateHook;\n                        }\n                    });\n                },\n            });\n        },\n    };\n});\n//# sourceMappingURL=index.js.map"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","defineProperty","exports","config","updatedModelName","name","updated","reducers","onUpdate","state","payload","_a","_b","action","Date","models","init","dispatch","onModel","_this","includes","modelActions","keys","forEach","isEffect","fn_1","props"],"mappings":"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"}